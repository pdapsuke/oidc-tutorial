import{V as h,_ as g}from"./rE6i81X2.js";import{d as k,r as w,L as y,o as x,m as i,M as T,A as V,q as b,t as S,z as l,x as s,B as u,y as v,N as d}from"./TkGXRdXq.js";import{u as A}from"./gvKhrfM5.js";import{V as C}from"./DnXjZbFg.js";const R=""+new URL("oidc_token_request_animation.DADkcxS6.svg",import.meta.url).href,U={class:"d-flex justify-center mb-5 font-weight-bold"},$=s("br",null,null,-1),q={class:"d-flex justify-center"},D=k({__name:"callback",setup(B){const a=w(null),n=y().query.code||"";n.toString();async function p(e){const c="http://localhost:8888/realms/oidc-tutorial/protocol/openid-connect/token",{clientId:r,redirectUri:m}=b().public,o=new URLSearchParams;o.append("grant_type","authorization_code"),o.append("code",e),o.append("client_id",`${r}`),o.append("redirect_uri",`${m}`);const f=t=>new Promise(_=>{setTimeout(_,t)});try{await f(15e3);const t=await fetch(c,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()});if(!t.ok)throw new Error("Failed to fetch access token");return t.json()}catch(t){a.value.error(`Error fetching access token: ${t}`),console.error("Error fetching access token:",t)}}return x(()=>{p(`${n}`).then(e=>{e?(console.log(e),A().login(e.access_token,e.refresh_token),i("/")):setTimeout(()=>{i("/login")},2e3)})}),(e,c)=>{const r=g;return S(),T(h,{class:"py-8 px-6 fillheight",fluid:""},{default:V(()=>[l(r,{ref_key:"alert",ref:a},null,512),s("div",U,[u("<リダイレクトURLから取得した認可コード> "),$,u(v(d(n)),1)]),s("div",q,[l(C,{src:d(R),alt:"Tooltip Image","max-width":"600","max-height":"600"},null,8,["src"])])]),_:1})}}});export{D as default};
